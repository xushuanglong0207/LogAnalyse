{"version":3,"sources":["../../../src/server/request/headers.ts"],"sourcesContent":["import {\n  HeadersAdapter,\n  type ReadonlyHeaders,\n} from '../web/spec-extension/adapters/headers'\nimport { workAsyncStorage } from '../app-render/work-async-storage.external'\nimport { getExpectedRequestStore } from '../app-render/work-unit-async-storage.external'\nimport {\n  workUnitAsyncStorage,\n  type PrerenderStoreModern,\n} from '../app-render/work-unit-async-storage.external'\nimport {\n  postponeWithTracking,\n  abortAndThrowOnSynchronousRequestDataAccess,\n  throwToInterruptStaticGeneration,\n  trackDynamicDataInDynamicRender,\n} from '../app-render/dynamic-rendering'\nimport { StaticGenBailoutError } from '../../client/components/static-generation-bailout'\nimport { makeResolvedReactPromise } from './utils'\nimport { makeHangingPromise } from '../dynamic-rendering-utils'\nimport { createDedupedByCallsiteServerErrorLoggerDev } from '../create-deduped-by-callsite-server-error-loger'\n\n/**\n * In this version of Next.js `headers()` returns a Promise however you can still reference the properties of the underlying Headers instance\n * synchronously to facilitate migration. The `UnsafeUnwrappedHeaders` type is added to your code by a codemod that attempts to automatically\n * updates callsites to reflect the new Promise return type. There are some cases where `headers()` cannot be automatically converted, namely\n * when it is used inside a synchronous function and we can't be sure the function can be made async automatically. In these cases we add an\n * explicit type case to `UnsafeUnwrappedHeaders` to enable typescript to allow for the synchronous usage only where it is actually necessary.\n *\n * You should should update these callsites to either be async functions where the `headers()` value can be awaited or you should call `headers()`\n * from outside and await the return value before passing it into this function.\n *\n * You can find instances that require manual migration by searching for `UnsafeUnwrappedHeaders` in your codebase or by search for a comment that\n * starts with `@next-codemod-error`.\n *\n * In a future version of Next.js `headers()` will only return a Promise and you will not be able to access the underlying Headers instance\n * without awaiting the return value first. When this change happens the type `UnsafeUnwrappedHeaders` will be updated to reflect that is it no longer\n * usable.\n *\n * This type is marked deprecated to help identify it as target for refactoring away.\n *\n * @deprecated\n */\nexport type UnsafeUnwrappedHeaders = ReadonlyHeaders\n\n/**\n * This function allows you to read the HTTP incoming request headers in\n * [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components),\n * [Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations),\n * [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) and\n * [Middleware](https://nextjs.org/docs/app/building-your-application/routing/middleware).\n *\n * Read more: [Next.js Docs: `headers`](https://nextjs.org/docs/app/api-reference/functions/headers)\n */\nexport function headers(): Promise<ReadonlyHeaders> {\n  const workStore = workAsyncStorage.getStore()\n  const workUnitStore = workUnitAsyncStorage.getStore()\n\n  if (workStore) {\n    if (workStore.forceStatic) {\n      // When using forceStatic we override all other logic and always just return an empty\n      // headers object without tracking\n      const underlyingHeaders = HeadersAdapter.seal(new Headers({}))\n      return makeUntrackedExoticHeaders(underlyingHeaders)\n    }\n\n    if (workUnitStore) {\n      if (workUnitStore.type === 'cache') {\n        throw new Error(\n          `Route ${workStore.route} used \"headers\" inside \"use cache\". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \"headers\" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`\n        )\n      } else if (workUnitStore.type === 'unstable-cache') {\n        throw new Error(\n          `Route ${workStore.route} used \"headers\" inside a function cached with \"unstable_cache(...)\". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \"headers\" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`\n        )\n      } else if (workUnitStore.phase === 'after') {\n        throw new Error(\n          `Route ${workStore.route} used \"headers\" inside \"unstable_after(...)\". This is not supported. If you need this data inside an \"unstable_after\" callback, use \"headers\" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/unstable_after`\n        )\n      }\n    }\n    if (workStore.dynamicShouldError) {\n      throw new StaticGenBailoutError(\n        `Route ${workStore.route} with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`headers\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`\n      )\n    }\n\n    if (workUnitStore) {\n      if (workUnitStore.type === 'prerender') {\n        // dynamicIO Prerender\n        // We don't track dynamic access here because access will be tracked when you access\n        // one of the properties of the headers object.\n        return makeDynamicallyTrackedExoticHeaders(\n          workStore.route,\n          workUnitStore\n        )\n      } else if (workUnitStore.type === 'prerender-ppr') {\n        // PPR Prerender (no dynamicIO)\n        // We are prerendering with PPR. We need track dynamic access here eagerly\n        // to keep continuity with how headers has worked in PPR without dynamicIO.\n        // TODO consider switching the semantic to throw on property access instead\n        postponeWithTracking(\n          workStore.route,\n          'headers',\n          workUnitStore.dynamicTracking\n        )\n      } else if (workUnitStore.type === 'prerender-legacy') {\n        // Legacy Prerender\n        // We are in a legacy static generation mode while prerendering\n        // We track dynamic access here so we don't need to wrap the headers in\n        // individual property access tracking.\n        throwToInterruptStaticGeneration('headers', workStore, workUnitStore)\n      }\n    }\n    // We fall through to the dynamic context below but we still track dynamic access\n    // because in dev we can still error for things like using headers inside a cache context\n    trackDynamicDataInDynamicRender(workStore, workUnitStore)\n  }\n\n  const requestStore = getExpectedRequestStore('headers')\n  if (process.env.NODE_ENV === 'development' && !workStore?.isPrefetchRequest) {\n    return makeUntrackedExoticHeadersWithDevWarnings(\n      requestStore.headers,\n      workStore?.route\n    )\n  } else {\n    return makeUntrackedExoticHeaders(requestStore.headers)\n  }\n}\n\ninterface CacheLifetime {}\nconst CachedHeaders = new WeakMap<CacheLifetime, Promise<ReadonlyHeaders>>()\n\nfunction makeDynamicallyTrackedExoticHeaders(\n  route: string,\n  prerenderStore: PrerenderStoreModern\n): Promise<ReadonlyHeaders> {\n  const cachedHeaders = CachedHeaders.get(prerenderStore)\n  if (cachedHeaders) {\n    return cachedHeaders\n  }\n\n  const promise = makeHangingPromise<ReadonlyHeaders>(\n    prerenderStore.renderSignal,\n    '`headers()`'\n  )\n  CachedHeaders.set(prerenderStore, promise)\n\n  Object.defineProperties(promise, {\n    append: {\n      value: function append() {\n        const expression = `headers().append(${describeNameArg(arguments[0])}, ...)`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    delete: {\n      value: function _delete() {\n        const expression = `headers().delete(${describeNameArg(arguments[0])})`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    get: {\n      value: function get() {\n        const expression = `headers().get(${describeNameArg(arguments[0])})`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    has: {\n      value: function has() {\n        const expression = `headers().has(${describeNameArg(arguments[0])})`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    set: {\n      value: function set() {\n        const expression = `headers().set(${describeNameArg(arguments[0])}, ...)`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    getSetCookie: {\n      value: function getSetCookie() {\n        const expression = `headers().getSetCookie()`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    forEach: {\n      value: function forEach() {\n        const expression = `headers().forEach(...)`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    keys: {\n      value: function keys() {\n        const expression = `headers().keys()`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    values: {\n      value: function values() {\n        const expression = `headers().values()`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    entries: {\n      value: function entries() {\n        const expression = `headers().entries()`\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n    [Symbol.iterator]: {\n      value: function () {\n        const expression = 'headers()[Symbol.iterator]()'\n        const error = createSyncHeadersError(route, expression)\n        abortAndThrowOnSynchronousRequestDataAccess(\n          route,\n          expression,\n          error,\n          prerenderStore\n        )\n      },\n    },\n  } satisfies HeadersExtensions)\n\n  return promise\n}\n\nfunction makeUntrackedExoticHeaders(\n  underlyingHeaders: ReadonlyHeaders\n): Promise<ReadonlyHeaders> {\n  const cachedHeaders = CachedHeaders.get(underlyingHeaders)\n  if (cachedHeaders) {\n    return cachedHeaders\n  }\n\n  const promise = makeResolvedReactPromise(underlyingHeaders)\n  CachedHeaders.set(underlyingHeaders, promise)\n\n  Object.defineProperties(promise, {\n    append: {\n      value: underlyingHeaders.append.bind(underlyingHeaders),\n    },\n    delete: {\n      value: underlyingHeaders.delete.bind(underlyingHeaders),\n    },\n    get: {\n      value: underlyingHeaders.get.bind(underlyingHeaders),\n    },\n    has: {\n      value: underlyingHeaders.has.bind(underlyingHeaders),\n    },\n    set: {\n      value: underlyingHeaders.set.bind(underlyingHeaders),\n    },\n    getSetCookie: {\n      value: underlyingHeaders.getSetCookie.bind(underlyingHeaders),\n    },\n    forEach: {\n      value: underlyingHeaders.forEach.bind(underlyingHeaders),\n    },\n    keys: {\n      value: underlyingHeaders.keys.bind(underlyingHeaders),\n    },\n    values: {\n      value: underlyingHeaders.values.bind(underlyingHeaders),\n    },\n    entries: {\n      value: underlyingHeaders.entries.bind(underlyingHeaders),\n    },\n    [Symbol.iterator]: {\n      value: underlyingHeaders[Symbol.iterator].bind(underlyingHeaders),\n    },\n  } satisfies HeadersExtensions)\n\n  return promise\n}\n\nfunction makeUntrackedExoticHeadersWithDevWarnings(\n  underlyingHeaders: ReadonlyHeaders,\n  route?: string\n): Promise<ReadonlyHeaders> {\n  const cachedHeaders = CachedHeaders.get(underlyingHeaders)\n  if (cachedHeaders) {\n    return cachedHeaders\n  }\n\n  const promise = makeResolvedReactPromise(underlyingHeaders)\n  CachedHeaders.set(underlyingHeaders, promise)\n\n  Object.defineProperties(promise, {\n    append: {\n      value: function append() {\n        const expression = `headers().append(${describeNameArg(arguments[0])}, ...)`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.append.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    delete: {\n      value: function _delete() {\n        const expression = `headers().delete(${describeNameArg(arguments[0])})`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.delete.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    get: {\n      value: function get() {\n        const expression = `headers().get(${describeNameArg(arguments[0])})`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.get.apply(underlyingHeaders, arguments as any)\n      },\n    },\n    has: {\n      value: function has() {\n        const expression = `headers().has(${describeNameArg(arguments[0])})`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.has.apply(underlyingHeaders, arguments as any)\n      },\n    },\n    set: {\n      value: function set() {\n        const expression = `headers().set(${describeNameArg(arguments[0])}, ...)`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.set.apply(underlyingHeaders, arguments as any)\n      },\n    },\n    getSetCookie: {\n      value: function getSetCookie() {\n        const expression = `headers().getSetCookie()`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.getSetCookie.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    forEach: {\n      value: function forEach() {\n        const expression = `headers().forEach(...)`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.forEach.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    keys: {\n      value: function keys() {\n        const expression = `headers().keys()`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.keys.apply(underlyingHeaders, arguments as any)\n      },\n    },\n    values: {\n      value: function values() {\n        const expression = `headers().values()`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.values.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    entries: {\n      value: function entries() {\n        const expression = `headers().entries()`\n        warnForSyncAccess(route, expression)\n        return underlyingHeaders.entries.apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n    [Symbol.iterator]: {\n      value: function () {\n        warnForSyncIteration(route)\n        return underlyingHeaders[Symbol.iterator].apply(\n          underlyingHeaders,\n          arguments as any\n        )\n      },\n    },\n  } satisfies HeadersExtensions)\n\n  return promise\n}\n\nfunction describeNameArg(arg: unknown) {\n  return typeof arg === 'string' ? `'${arg}'` : '...'\n}\n\nconst noop = () => {}\n\nconst warnForSyncIteration = process.env\n  .__NEXT_DISABLE_SYNC_DYNAMIC_API_WARNINGS\n  ? noop\n  : createDedupedByCallsiteServerErrorLoggerDev(\n      function getSyncIterationMessage(route?: string) {\n        const prefix = route ? ` In route ${route} ` : ''\n        return new Error(\n          `${prefix}headers were iterated over. ` +\n            `\\`headers()\\` should be awaited before using its value. ` +\n            `Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`\n        )\n      }\n    )\n\nconst warnForSyncAccess = process.env.__NEXT_DISABLE_SYNC_DYNAMIC_API_WARNINGS\n  ? noop\n  : createDedupedByCallsiteServerErrorLoggerDev(function getSyncAccessMessage(\n      route: undefined | string,\n      expression: string\n    ) {\n      const prefix = route ? ` In route ${route} a ` : 'A '\n      return new Error(\n        `${prefix}header property was accessed directly with \\`${expression}\\`. ` +\n          `\\`headers()\\` should be awaited before using its value. ` +\n          `Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`\n      )\n    })\n\ntype HeadersExtensions = {\n  [K in keyof ReadonlyHeaders]: unknown\n}\n\nfunction createSyncHeadersError(route: string, expression: string) {\n  return new Error(\n    `Route \"${route}\" used ${expression}. \\`headers()\\` now returns a Promise and should be \\`awaited\\` before using it's value. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`\n  )\n}\n"],"names":["HeadersAdapter","workAsyncStorage","getExpectedRequestStore","workUnitAsyncStorage","postponeWithTracking","abortAndThrowOnSynchronousRequestDataAccess","throwToInterruptStaticGeneration","trackDynamicDataInDynamicRender","StaticGenBailoutError","makeResolvedReactPromise","makeHangingPromise","createDedupedByCallsiteServerErrorLoggerDev","headers","workStore","getStore","workUnitStore","forceStatic","underlyingHeaders","seal","Headers","makeUntrackedExoticHeaders","type","Error","route","phase","dynamicShouldError","makeDynamicallyTrackedExoticHeaders","dynamicTracking","requestStore","process","env","NODE_ENV","isPrefetchRequest","makeUntrackedExoticHeadersWithDevWarnings","CachedHeaders","WeakMap","prerenderStore","cachedHeaders","get","promise","renderSignal","set","Object","defineProperties","append","value","expression","describeNameArg","arguments","error","createSyncHeadersError","delete","_delete","has","getSetCookie","forEach","keys","values","entries","Symbol","iterator","bind","warnForSyncAccess","apply","warnForSyncIteration","arg","noop","__NEXT_DISABLE_SYNC_DYNAMIC_API_WARNINGS","getSyncIterationMessage","prefix","getSyncAccessMessage"],"mappings":"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"}