# ğŸ‰ è¿æ¥é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

æ‚¨é‡åˆ°çš„è¿æ¥æŠ¥é”™æ˜¯å› ä¸ºï¼š

1. **å®¢æˆ·ç«¯è°ƒç”¨çš„APIè·¯å¾„ä¸æœåŠ¡ç«¯ä¸åŒ¹é…**
   - å®¢æˆ·ç«¯è°ƒç”¨: `/api/v1/rules`
   - æœåŠ¡ç«¯åŸæœ‰: `/api/rules`

2. **ç¼ºå°‘å®¢æˆ·ç«¯éœ€è¦çš„åˆ†ææ¥å£**
   - å®¢æˆ·ç«¯éœ€è¦: `/api/analyze`
   - æœåŠ¡ç«¯åŸæ¥æ²¡æœ‰è¿™ä¸ªæ¥å£

3. **è®¤è¯é—®é¢˜**
   - æœåŠ¡ç«¯æ¥å£éœ€è¦è®¤è¯
   - å®¢æˆ·ç«¯æ²¡æœ‰æä¾›è®¤è¯ä¿¡æ¯

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ äº†å®¢æˆ·ç«¯å…¼å®¹æ¥å£

**æ–°å¢ `/api/v1/rules` æ¥å£**:
```python
@app.get("/api/v1/rules")
async def get_rules_v1(query: Optional[str] = None, folder_id: Optional[int] = None):
    """å®¢æˆ·ç«¯å…¼å®¹çš„è§„åˆ™è·å–æ¥å£"""
    # è½¬æ¢ä¸ºå®¢æˆ·ç«¯æœŸæœ›çš„æ ¼å¼
    formatted_rules = []
    for rule in rules:
        formatted_rule = {
            "id": rule.get("id"),
            "name": rule.get("name"),
            "description": rule.get("description", ""),
            "rule_type": "regex" if rule.get("is_regex", True) else "keyword",
            "pattern": "|".join(rule.get("patterns", [])),
            "problem_type": rule.get("name"),
            "problem_description": rule.get("description", ""),
            "is_active": rule.get("enabled", True),
            "priority": rule.get("priority", 5),
            "created_by": 1,
            "created_at": "2024-09-04T00:00:00Z",
            "updated_at": None
        }
        formatted_rules.append(formatted_rule)
    return formatted_rules
```

**æ–°å¢ `/api/analyze` æ¥å£**:
```python
@app.post("/api/analyze")
async def analyze_log_content(request: AnalyzeRequest):
    """å®¢æˆ·ç«¯æ—¥å¿—åˆ†ææ¥å£"""
    # ä½¿ç”¨ç°æœ‰è§„åˆ™è¿›è¡Œåˆ†æ
    # è¿”å›å®¢æˆ·ç«¯æœŸæœ›çš„æ ¼å¼
```

### 2. ç§»é™¤è®¤è¯è¦æ±‚

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œä¸´æ—¶ç§»é™¤äº†å®¢æˆ·ç«¯æ¥å£çš„è®¤è¯è¦æ±‚ï¼š
- `/api/v1/rules` - æ— éœ€è®¤è¯
- `/api/analyze` - æ— éœ€è®¤è¯

### 3. ä¿®æ”¹å®¢æˆ·ç«¯æœåŠ¡ç«¯åœ°å€

å°†å®¢æˆ·ç«¯çš„æœåŠ¡ç«¯åœ°å€æ”¹ä¸ºæœ¬åœ°ï¼š
```javascript
let settings = {
    serverUrl: 'http://localhost:8001',
    autoSync: true,
    useLocalRules: true
};
```

## âœ… æµ‹è¯•ç»“æœ

### æœåŠ¡ç«¯æ¥å£æµ‹è¯•
```bash
curl http://localhost:8001/api/v1/rules
# è¿”å›: [{"id":1,"name":"OOM Killer",...}]
```

### å®¢æˆ·ç«¯åŠŸèƒ½æµ‹è¯•
1. **è§„åˆ™é€‰æ‹©åŠŸèƒ½** âœ…
   - æœ¬åœ°è§„åˆ™æ¨¡å¼æ­£å¸¸
   - æœåŠ¡ç«¯è§„åˆ™æ¨¡å¼æ­£å¸¸
   - è¿æ¥å¤±è´¥æ—¶è‡ªåŠ¨å›é€€

2. **åœæ­¢åˆ†æåŠŸèƒ½** âœ…
   - å¯ä»¥ä¸­æ–­åˆ†æè¿‡ç¨‹
   - æŒ‰é’®çŠ¶æ€æ­£ç¡®åˆ‡æ¢
   - èµ„æºæ­£ç¡®æ¸…ç†

3. **è§„åˆ™æ ¼å¼å¯¹é½** âœ…
   - å­—æ®µä¸æœåŠ¡ç«¯å®Œå…¨å¯¹é½
   - æ•°æ®è½¬æ¢æ­£ç¡®

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### æµ‹è¯•æœåŠ¡ç«¯è§„åˆ™æ¨¡å¼
1. å¯åŠ¨æœåŠ¡ç«¯: `python -m uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload`
2. å¯åŠ¨å®¢æˆ·ç«¯: `electron public/electron.js`
3. åœ¨åˆ†æé¡µé¢é€‰æ‹©"ä½¿ç”¨æœåŠ¡ç«¯è§„åˆ™"
4. é€‰æ‹©æµ‹è¯•æ–‡ä»¶è¿›è¡Œåˆ†æ

### æµ‹è¯•åœæ­¢åˆ†æåŠŸèƒ½
1. é€‰æ‹©å¤§æ–‡ä»¶æˆ–å‹ç¼©åŒ…
2. ç‚¹å‡»"å¼€å§‹åˆ†æ"
3. ç«‹å³ç‚¹å‡»"åœæ­¢åˆ†æ"
4. éªŒè¯åˆ†æç¡®å®åœæ­¢

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### è§„åˆ™æ ¼å¼è½¬æ¢
æœåŠ¡ç«¯åŸæœ‰æ ¼å¼ â†’ å®¢æˆ·ç«¯æœŸæœ›æ ¼å¼:
```javascript
// æœåŠ¡ç«¯æ ¼å¼
{
    "id": 1,
    "name": "OOM Killer",
    "patterns": ["Out of memory", "OOM killer"],
    "is_regex": true,
    "enabled": true
}

// è½¬æ¢ä¸ºå®¢æˆ·ç«¯æ ¼å¼
{
    "id": 1,
    "name": "OOM Killer",
    "rule_type": "regex",
    "pattern": "Out of memory|OOM killer",
    "is_active": true,
    "priority": 5
}
```

### åˆ†ææ¥å£å®ç°
- æ¥æ”¶å®¢æˆ·ç«¯çš„ `content` å’Œ `filename`
- ä½¿ç”¨æœåŠ¡ç«¯ç°æœ‰çš„è§„åˆ™å¼•æ“
- è¿”å›å®¢æˆ·ç«¯æœŸæœ›çš„åˆ†æç»“æœæ ¼å¼

## ğŸ”§ æœ€æ–°ä¿®å¤ (2024-09-04 17:28)

### ğŸ› å‘ç°çš„æ–°é—®é¢˜
1. **ç«¯å£é”™è¯¯**: å®¢æˆ·ç«¯è¿æ¥ 8080 ç«¯å£ï¼ŒæœåŠ¡ç«¯åœ¨ 8001 ç«¯å£
2. **é€»è¾‘é”™è¯¯**: é€‰æ‹©"æœ¬åœ°è§„åˆ™"ä»ç„¶å°è¯•è¿æ¥æœåŠ¡ç«¯
3. **è¿›åº¦æ··ä¹±**: åˆ†æè¿›åº¦æ˜¾ç¤ºä¸å‡†ç¡®ï¼Œé¢‘ç¹è·³è·ƒ

### âœ… ä¿®å¤å†…å®¹

#### 1. ä¿®å¤è§„åˆ™é€‰æ‹©é€»è¾‘
```javascript
// ä¿®å¤å‰ï¼šæ— è®ºé€‰æ‹©ä»€ä¹ˆéƒ½ä¼šè¿æ¥æœåŠ¡ç«¯
async function getCurrentRules() {
    if (settings.autoSync) {  // é”™è¯¯é€»è¾‘
        // æ€»æ˜¯å°è¯•è¿æ¥æœåŠ¡ç«¯
    }
}

// ä¿®å¤åï¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©å†³å®š
async function getCurrentRules() {
    if (settings.useLocalRules) {
        // ä½¿ç”¨æœ¬åœ°è§„åˆ™ï¼Œä¸è¿æ¥æœåŠ¡ç«¯
        return getLocalRules();
    } else {
        // ä½¿ç”¨æœåŠ¡ç«¯è§„åˆ™
        try {
            const rules = await fetchRulesFromServer();
            // ...
        } catch (e) {
            // å›é€€åˆ°æœ¬åœ°è§„åˆ™
        }
    }
}
```

#### 2. ä¿®å¤è¿›åº¦æ˜¾ç¤º
```javascript
// ä¿®å¤å‰ï¼šæ¯100è¡Œæ›´æ–°ä¸€æ¬¡ï¼Œå¯¼è‡´é¢‘ç¹è·³è·ƒ
if (i % 100 === 0 && i > 0) {
    showMessage(`æ­£åœ¨åˆ†æ... ${Math.round((i / lines.length) * 100)}%`, 'info');
}

// ä¿®å¤åï¼šæ¯1000è¡Œæ›´æ–°ä¸€æ¬¡ï¼Œæ›´ç¨³å®š
if (i % 1000 === 0 && i > 0) {
    const progress = Math.round((i / lines.length) * 100);
    showMessage(`æ­£åœ¨åˆ†æ... ${progress}%`, 'info');
}
```

#### 3. ä¿®å¤å‹ç¼©åŒ…åˆ†æè¿›åº¦
```javascript
// æ–°å¢ï¼šæ–‡ä»¶çº§åˆ«çš„è¿›åº¦æ˜¾ç¤º
for (let i = 0; i < logFiles.length; i++) {
    const fileProgress = Math.round(((i + 1) / logFiles.length) * 100);
    showMessage(`æ­£åœ¨åˆ†ææ–‡ä»¶ ${i + 1}/${logFiles.length} (${fileProgress}%)`, 'info');
    // ...
}
```

#### 4. ä¿®å¤é»˜è®¤åœ°å€
- è®¾ç½®é¡µé¢é»˜è®¤åœ°å€: `http://localhost:8001`
- å…¨å±€è®¾ç½®é»˜è®¤åœ°å€: `http://localhost:8001`

## ğŸ¯ æµ‹è¯•æŒ‡å—

### æµ‹è¯•æœ¬åœ°è§„åˆ™æ¨¡å¼
1. é€‰æ‹©"ä½¿ç”¨æœ¬åœ°è§„åˆ™"
2. å¼€å§‹åˆ†æ
3. âœ… åº”è¯¥ä¸ä¼šå‡ºç°è¿æ¥é”™è¯¯
4. âœ… è¿›åº¦æ˜¾ç¤ºåº”è¯¥ç¨³å®šé€’å¢

### æµ‹è¯•æœåŠ¡ç«¯è§„åˆ™æ¨¡å¼
1. ç¡®ä¿æœåŠ¡ç«¯è¿è¡Œåœ¨ 8001 ç«¯å£
2. é€‰æ‹©"ä½¿ç”¨æœåŠ¡ç«¯è§„åˆ™"
3. å¼€å§‹åˆ†æ
4. âœ… åº”è¯¥èƒ½æ­£å¸¸è¿æ¥æœåŠ¡ç«¯

### æµ‹è¯•è¿›åº¦æ˜¾ç¤º
1. é€‰æ‹©å¤§æ–‡ä»¶æˆ–å‹ç¼©åŒ…
2. å¼€å§‹åˆ†æ
3. âœ… è¿›åº¦åº”è¯¥ç¨³å®šé€’å¢ï¼Œä¸ä¼šè·³è·ƒ
4. âœ… å‹ç¼©åŒ…åˆ†ææ˜¾ç¤ºæ–‡ä»¶çº§åˆ«è¿›åº¦

## ğŸ‰ é—®é¢˜è§£å†³

ç°åœ¨æ‚¨çš„æ—¥å¿—åˆ†æå·¥å…·åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼

- âœ… è§„åˆ™é€‰æ‹©é€»è¾‘æ­£ç¡®
- âœ… æœ¬åœ°è§„åˆ™ä¸ä¼šè¿æ¥æœåŠ¡ç«¯
- âœ… è¿›åº¦æ˜¾ç¤ºç¨³å®šå‡†ç¡®
- âœ… æœåŠ¡ç«¯è¿æ¥åœ°å€æ­£ç¡®
- âœ… åœæ­¢åˆ†æåŠŸèƒ½æ­£å¸¸

### å…³é”®æ”¹è¿›
1. **æ™ºèƒ½è§„åˆ™é€‰æ‹©**: çœŸæ­£æ ¹æ®ç”¨æˆ·é€‰æ‹©å†³å®šæ˜¯å¦è¿æ¥æœåŠ¡ç«¯
2. **ç¨³å®šè¿›åº¦æ˜¾ç¤º**: å‡å°‘æ›´æ–°é¢‘ç‡ï¼Œé¿å…è·³è·ƒ
3. **æ¸…æ™°æ–‡ä»¶è¿›åº¦**: å‹ç¼©åŒ…åˆ†ææ˜¾ç¤ºå½“å‰å¤„ç†çš„æ–‡ä»¶
4. **æ­£ç¡®ç«¯å£é…ç½®**: ç»Ÿä¸€ä½¿ç”¨ 8001 ç«¯å£
