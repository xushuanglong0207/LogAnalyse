# 日志分析工具 - 功能更新说明

## 🎉 最新更新 (v1.1.0) - 2024-09-04

### 🆕 新增核心功能

#### 1. 规则选择功能
- **本地规则模式**: 使用本地存储的规则，无需网络连接
- **服务端规则模式**: 连接服务端获取最新规则
- **智能回退**: 服务端连接失败时自动回退到本地规则
- **状态指示**: 实时显示当前使用的规则源

#### 2. 停止分析功能
- **中断控制**: 支持随时停止正在进行的分析
- **进度显示**: 实时显示分析进度
- **按钮状态**: 动态切换"开始分析"和"停止分析"按钮
- **资源清理**: 停止时自动清理临时文件和内存

#### 3. 规则格式对齐
- **服务端兼容**: 规则字段与后端API完全对齐
- **字段完整**: 支持所有服务端规则字段
  - `name`: 规则名称
  - `description`: 规则描述
  - `rule_type`: 规则类型 (regex/keyword/dsl)
  - `pattern`: 匹配模式
  - `problem_type`: 问题类型
  - `problem_description`: 问题描述
  - `is_active`: 是否启用
  - `priority`: 优先级
  - `created_by`: 创建者
  - `created_at`: 创建时间
  - `updated_at`: 更新时间

## 🎉 之前更新 (v1.0.0)

### ✅ 已修复的问题

#### 1. 服务端地址配置
- **问题**: 默认服务端地址错误 (localhost:8080)
- **修复**: 更新为正确的默认地址 `http://172.17.20.117:8001`
- **影响**: 设置页面、规则同步、连接测试

#### 2. 压缩包格式支持
- **问题**: 缺少 .tgz 格式支持
- **修复**: 添加对 .tgz 格式的完整支持
- **支持格式**: .zip, .tar, .gz, .tgz

#### 3. 添加规则功能
- **问题**: 点击"添加规则"没有反应
- **修复**: 实现完整的规则添加界面
- **新功能**: 
  - 模态对话框界面
  - 表单验证
  - 正则表达式验证
  - 优先级选择

#### 4. 压缩包分析功能
- **问题**: 显示"功能开发中"
- **修复**: 实现完整的压缩包分析功能
- **新功能**:
  - 自动解压多种格式
  - 递归扫描日志文件
  - 批量分析处理
  - 结果合并展示

## 🚀 新增功能

### 📁 压缩包全量分析
- **自动解压**: 支持 ZIP, TAR, GZ, TGZ 格式
- **智能扫描**: 自动识别日志文件 (.log, .txt, .out, .err)
- **批量处理**: 并发分析多个文件
- **结果整合**: 统一显示所有文件的分析结果
- **文件标识**: 每个问题显示来源文件信息

### 📋 增强的规则管理
- **可视化添加**: 友好的表单界面
- **规则验证**: 实时验证正则表达式
- **类型选择**: 支持正则表达式和关键字匹配
- **优先级设置**: 4个级别的优先级选择
- **详细描述**: 支持多行问题描述

### ⚙️ 改进的设置功能
- **正确默认值**: 服务端地址默认为 172.17.20.117:8001
- **连接测试**: 验证服务端可用性
- **数据管理**: 清除所有本地数据功能

## 📊 分析报告增强

### 多文件支持
- **文件统计**: 显示分析的文件数量
- **源文件标识**: 每个问题显示来源文件
- **分类展示**: 按文件分组的问题列表

### 详细信息
- **问题定位**: 精确的行号和文件位置
- **严重程度**: 高危/中危问题分类
- **规则匹配**: 显示触发的规则名称

## 🔧 技术改进

### 文件处理
- **临时目录**: 安全的临时文件管理
- **自动清理**: 分析完成后自动清理临时文件
- **错误处理**: 完善的异常处理机制

### 用户体验
- **进度提示**: 详细的操作进度反馈
- **错误提示**: 友好的错误信息显示
- **界面优化**: 更直观的操作界面

## 📝 测试数据

### 单个文件测试
- `test_log.txt` - 包含各种日志级别的测试文件

### 压缩包测试
- `test_logs.zip` - 包含多个日志文件的压缩包
  - `app.log` - 应用程序日志
  - `system.log` - 系统日志

## 🎯 使用指南

### 快速开始
1. 启动应用: `.\start-final.bat`
2. **选择规则源**: 在分析页面选择"本地规则"或"服务端规则"
3. 测试单个分析: 选择 `test_log.txt`
4. 测试压缩包分析: 选择 `test_logs.zip`
5. 查看分析报告和问题详情

### 规则选择使用
1. **本地规则模式** (推荐):
   - 无需网络连接
   - 使用本地存储的规则
   - 分析速度更快

2. **服务端规则模式**:
   - 需要网络连接
   - 获取最新的服务端规则
   - 支持团队共享规则

### 停止分析功能
1. 点击"开始分析"后，按钮变为"停止分析"
2. 随时点击"停止分析"中断处理
3. 系统自动清理临时文件
4. 可以重新开始新的分析

### 规则管理
1. 点击"规则管理"标签
2. 点击"添加规则"按钮
3. 填写完整的规则信息:
   - 规则名称 (必填)
   - 规则描述
   - 规则类型 (正则/关键字/DSL)
   - 匹配模式 (必填)
   - 问题类型
   - 问题描述
   - 优先级
4. 保存并测试新规则

### 设置配置
1. 点击"设置"标签
2. 配置服务端地址
3. 测试连接状态
4. 保存设置

## 🐛 已知限制

### 压缩包格式
- 暂不支持 .rar 和 .7z 格式（需要额外工具）
- 推荐使用 .zip 和 .tgz 格式

### 文件大小
- 单个日志文件建议不超过 100MB
- 压缩包解压后总大小建议不超过 500MB

### 系统要求
- Windows 系统需要 PowerShell 支持
- Linux/Mac 系统需要 tar 命令支持

## 📞 技术支持

### 常见问题
1. **压缩包解压失败**: 检查文件格式和权限
2. **规则不生效**: 验证正则表达式语法
3. **服务端连接失败**: 检查网络和地址配置

### 调试方法
1. 按 F12 打开开发者工具
2. 查看 Console 中的错误信息
3. 检查 Network 中的请求状态

---

## 📋 测试清单

### ✅ 功能测试项目

#### 规则选择功能
- [ ] 单个分析页面规则选择正常
- [ ] 全量分析页面规则选择正常
- [ ] 本地规则模式分析正常
- [ ] 服务端规则模式分析正常
- [ ] 服务端连接失败时回退到本地规则
- [ ] 规则选择状态正确保存和加载

#### 停止分析功能
- [ ] 单个文件分析可以正常停止
- [ ] 压缩包分析可以正常停止
- [ ] 停止后按钮状态正确恢复
- [ ] 停止后临时文件正确清理
- [ ] 停止后可以重新开始分析

#### 规则管理功能
- [ ] 添加规则界面字段完整
- [ ] 规则验证功能正常
- [ ] 规则保存格式与服务端对齐
- [ ] 规则列表显示正常
- [ ] 规则启用/禁用功能正常

#### 压缩包分析功能
- [ ] .zip 格式解压正常
- [ ] .tgz 格式解压正常
- [ ] 多文件分析结果正确
- [ ] 源文件信息显示正确

---

**版本**: v1.1.0
**更新时间**: 2024-09-04
**更新内容**: 新增规则选择、停止分析功能，规则格式与服务端对齐
